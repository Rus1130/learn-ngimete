<style>
    th {
        text-align: left;
    }

    td {
        width: 33.33%;
    }

    /* #nav {
        position: fixed;
    } */

    #output {
        max-height: 100%;
    }

    #container {
        overflow: auto;
        max-height: calc(100vh - 100px);
    }
</style>
<head>
    <script src="dictionary.js" type="module"></script>
</head>
<body>
    <div id="nav">
        <div>
            Search Term: <textarea id="input"></textarea>
        </div>
        <div>
            Dialect:
            <input type="checkbox" id="dialect-standard" name="dialect" value="Standard" checked> Standard
            <input type="checkbox" id="dialect-aatsilwi" name="dialect" value="A'atsilwi" checked> A'atsilwi
            <br>
            <label for="swap">swap:</label>
            <input type="checkbox" id="swap" name="swap" value="swap" title="when checked, swaps from searching through the terms (english) to searching through the definitions (ngimÃ«te)">
        </div>
    </div>

    <div id="container">
        <table id="output"></table>
    </div>

    
</body>
<script type="module">
    import { dict } from './dictionary.js';

    
    let input = document.getElementById("input")
    let output = document.getElementById("output")

    let dialectCheckboxes = document.querySelectorAll('input[name="dialect"]');

    dialectCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', () => {
            let checkedCount = [...dialectCheckboxes].filter(cb => cb.checked).length;

        if (checkedCount === 0) {
            checkbox.checked = true;
        }
        });
    });

    function updateDictionary() {
        let dialects = Array.from(document.getElementsByName("dialect")).map(d => d.checked ? d.value : null).filter(d => d)

        let options = {};
        if(dialects.length != 2) {
            options.dialect = dialects[0]
        }
        options.swap = document.getElementById("swap").checked

        dict.waitForDictLoad().then(() => {
            let wordSearchResult = dict.wordSearch(input.value, options);
            let table = "<tr><th>Word</th><th id='definition_tableheader'>Definition</th><th>Category</th></tr>"
            wordSearchResult.results.forEach(result => {
                let term = result.key
                let definition = Object.values(result.value).join(", ")
                definition ? "" : definition = ""

                table += `<tr><td>${result.key}</td><td>${[...new Set(Object.values(result.value))].join(", ")}</td><td>${result.category}</td></tr>`
            })
            output.innerHTML = table
        })
    }

    [...document.querySelectorAll('input[type="checkbox"]'), input].forEach(element => {
        element.addEventListener("input", () => {
            updateDictionary()
        })
    })

    updateDictionary()

    // dict.waitForDictLoad().then(() => {
    //     let wordSearchResult = dict.wordSearch("", {
    //         dialect: "A'atsilwi"
    //     });
    //     console.log(wordSearchResult)
    // })
</script>