<style>
    th {
        text-align: left;
    }

    td {
        width: 33.33%;
    }

    #input {
        height: 14pt;
    }

    #input {
        resize: none;
        overflow-y: hidden;
    }

    #output {
        max-height: 100%;
    }

    #container {
        overflow: auto;
        max-height: calc(100vh - 100px);
    }

    #popout {
        position: absolute;
        right: 7px;
        top: 9px;
    }

    input[type="checkbox"]:focus, #input:focus {
        outline: none;
    }

</style>
<head>
    <script src="dictionary.js" type="module"></script>
</head>
<body>
    <div id="nav">
        <button id="popout">Popout Dictionary</button>
        <div>
            <div>
                <span>Search:</span>
                <textarea id="input"></textarea>
            </div>
        </div>
        <div>
            Dialect:
            <input type="checkbox" id="dialect-standard" name="dialect" value="Standard" checked> Standard
            <input type="checkbox" id="dialect-aatsilwi" name="dialect" value="A'atsilwi" checked> A'atsilwi
            <br>
            <label for="swap">swap:</label>
            <input type="checkbox" id="swap" name="swap" value="swap" title="when checked, swaps from searching through the terms (english) to searching through the definitions (ngimÃ«te)">
        </div>
    </div>
    <div id="container">
        <table id="output"></table>
    </div>

    
</body>
<script type="module">
    import { dict } from './dictionary.js';

    
    let input = document.getElementById("input")
    let output = document.getElementById("output")

    let dialectCheckboxes = document.querySelectorAll('input[name="dialect"]');

    let button = document.getElementById("popout")


    function updateDictionary() {
        let dialects = Array.from(document.getElementsByName("dialect")).map(d => d.checked ? d.value : null).filter(d => d)

        let options = {};
        if(dialects.length != 2) {
            options.dialect = dialects[0]
        }
        options.swap = document.getElementById("swap").checked

        dict.waitForDictLoad().then(() => {
            let wordSearchResult = dict.wordSearch(input.value, options);
            let table = "<tr><th>Word</th><th id='definition_tableheader'>Definition</th><th>Category</th></tr>"

            if(wordSearchResult.results.length == 0) table += "<tr><td colspan='3'>No results found</td></tr>"
            wordSearchResult.results.forEach(result => {
                let term = result.key
                let definition = Object.values(result.value).join(", ")
                definition ? "" : definition = ""

                table += `<tr><td>${result.key}</td><td>${[...new Set(Object.values(result.value))].join(", ")}</td><td>${result.category}</td></tr>`
            })
            output.innerHTML = table
        })
    }

    [...document.querySelectorAll('input[type="checkbox"]'), input].forEach(element => {
        element.addEventListener("input", (e) => {
            if(e.key == "Enter") e.preventDefault();
            updateDictionary()
        })
    })

    button.addEventListener("click", () => {
        dict.openDictionary("window")
    })

    // check if the url parameter "button" is set to "false"
    
    new URLSearchParams(window.location.search).get("b") == "false" ? button.style.display = "none" : "";

    updateDictionary()
</script>